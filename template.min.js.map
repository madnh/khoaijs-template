{"version":3,"sources":["template.min.js"],"names":["root","factory","define","amd","dependencies","_","Khoai","EventEmitter","module","Template","this","sections","layout","type_prefix","call","dataSource","options","_layout","_sections","isUndefined","self","setLayout","isObject","each","section_name","cb","setSection","getSubSections","str","tmp_match","re","RegExp","result","exec","push","renderContent","content","instance","data","sub_sections","isFunction","missing_subsections","difference","Object","keys","isEmpty","console","warn","missing_subsection","zipObject","fill","Array","length","sub_section_value","sub_section_name","replace","toUpperCase","prototype","create","constructor","option","value","util","setup","apply","concat","toArray","arguments","connect","data_source","disconnect","listen","emitEvent","unlisten","getDataSource","isConnected","getLayout","name","key","bind","currentDraw","currentID","id","getDOMID","prepareData","render","_data","extend","nextID","draw","dom_id","template","rendered","reDraw","dom","getDOM","new_content","replaceWith","document","getElementById","_templates","compilers","types","hasCompiler","has","compiler","register","type","hasOwnProperty","_default","constructors","detail","mapObject","type_detail","hasType","templates","name_only","clone","hasTemplate","defaultTemplate","default_template","Error","templateInstance","default_name"],"mappings":"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","file":"template.min.js","sourcesContent":["!function(t,e){if(\"function\"==typeof define&&define.amd){var n=[\"lodash\",\"khoaijs\",\"khoaijs-event-emitter\"];define(n,function(n,r,s){var o=e(n,r,s);return r.Template=o,t.Template=o,o})}else{var r=e(t._,t.Khoai,t.Khoai.EventEmitter||t.EventEmitter);t.Khoai.Template=r,t.Template=r}}(this,function(t,e,n){\"use strict\";function r(e,r){this.type_prefix=\"template\",n.call(this),this.dataSource=null,this.options={},this._layout=\"\",this._sections={},t.isUndefined(r)||self.setLayout(r),t.isObject(e)&&t.each(e,function(t,e){self.setSection(t,e)})}function s(t){for(var e,n=new RegExp(\"@([A-Z0-9_-]+)@\",\"gi\"),r=[];null!==(e=n.exec(t));)r.push(e[1]);return r}function o(e,n,r,i){var c=\"\",u=[];c=t.isFunction(e)?e(n,n.dataSource,i):e+\"\",u=s(c);var a=t.difference(u,Object.keys(r));return t.isEmpty(a)||(console.warn(\"Missing subsections:\",a),t.each(a,function(t){r[t]=\"\",u[t]=\"\"})),u=t.zipObject(u,t.fill(new Array(u.length),\"\")),t.isEmpty(u)||(t.each(u,function(t,e){r[e]=o(r[e],n,r,i),u[e]=r[e]}),t.each(u,function(t,e){c=c.replace(new RegExp(\"@\"+e.toUpperCase()+\"@\",\"gi\"),t)})),c}r.prototype=Object.create(n.prototype),r.prototype.constructor=r,r.prototype.option=function(n,r){return this.options=e.util.setup.apply(null,[this.options].concat(t.toArray(arguments))),this},r.prototype.connect=function(t){return null!==this.dataSource&&this.disconnect(),this.dataSource=t,t instanceof n&&this.listen(t),this.emitEvent(\"connected\"),this},r.prototype.disconnect=function(){return null!==this.dataSource&&(this.emitEvent(\"before_disconnect\"),this.dataSource instanceof n&&this.unlisten(this.dataSource),this.dataSource=null,this.emitEvent(\"disconnected\"),!0)},r.prototype.getDataSource=function(){return this.dataSource},r.prototype.isConnected=function(){return null!==this.dataSource},r.prototype.setLayout=function(t){return this._layout=t,this},r.prototype.getLayout=function(){return this._layout},r.prototype.setSection=function(e,n){return t.isObject(e)?t.each(e,function(t,e){this._sections[e.toUpperCase()]=t}.bind(this)):this._sections[e.toUpperCase()]=n,this},r.prototype.currentDraw=function(){return e.util.currentID(this.id+\"_draw\",!1)},r.prototype.getDOMID=function(){return this.id},r.prototype.prepareData=function(){return{}},r.prototype.render=function(n){var r,s=this,i=t.extend({},{option:this.options,data_source:this.getDataSource()}),c=t.extend({},this._sections);return e.util.nextID(this.id+\"_draw\"),i.draw=this.currentDraw(),i.dom_id=this.getDOMID(),t.extend(i,this.prepareData(i),t.isObject(n)?n:{}),r=t.isFunction(this._layout)?this._layout(s,this.dataSource,i):this._layout+\"\",r=o(r,this,c,i),t.template(r)(i)},r.prototype.rendered=function(){},r.prototype.reDraw=function(t){var e=this.getDOM();if(e){var n=this.render(t);return this.emitEvent(\"re-draw\"),e.first().replaceWith(n),this.emitEvent(\"drawn\",n),this.rendered(),!0}return!1},r.prototype.getDOM=function(){return document.getElementById(this.getDOMID())};var i={compilers:{},types:{}};return r.hasCompiler=function(e){return t.has(i.compilers,e)},r.compiler=function(t,e){i.compilers[t]=e},r.compilers=function(){return Object.keys(i.compilers)},r.render=function(t,e){return!!this.hasCompiler(t)&&(1==arguments.length&&(e={}),i.compilers[t](e))},r.register=function(t,e,n){return i.types.hasOwnProperty(t)||(i.types[t]={_default:null,constructors:{}}),!i.types[t].hasOwnProperty(e)&&(i.types[t].constructors[e]=n,i.types[t]._default||(i.types[t]._default=e),!0)},r.types=function(e){return e?t.mapObject(i.types,function(t){return Object.keys(t.constructors)}):Object.keys(i.types)},r.hasType=function(t){return i.types.hasOwnProperty(t)},r.templates=function(e,n){return n?Object.keys(i.types[e].constructors):t.clone(i.types[e].constructors)},r.hasTemplate=function(t,e){return i.types.hasOwnProperty(t)&&i.types[t].constructors.hasOwnProperty(e)},r.defaultTemplate=function(e,n){if(!t.isEmpty(i.types[e].constructors)){if(n){if(i.types[e].constructors.hasOwnProperty(n))return i.types[e]._default=n,!0;throw new Error(\"Set default template with invalid template name\")}if(i.types[e]._default&&this.hasTemplate(e,i.types[e]._default))return i.types[e]._default;var r=Object.keys(i.types[e].constructors)[0];return i.types[e]._default=r,new i.types[e].constructors[r]}return!1},r.templateInstance=function(t,e){if(arguments.length<2){var n=this.defaultTemplate(t);if(!1!==n)return new i.types[t].constructors[n]}else if(this.hasTemplate(t,e))return new i.types[t].constructors[e];throw new Error(\"Template with name isn't exists or invalid type\")},r});\n//# sourceMappingURL=template.min.js.map\n"]}